---
title: Fragment size distribution of merged overlapping reads vs. aligned reads
author: Shaun Jackman
date: 2015-01-28
---

+ Species: E.coli K-12 MG1655
+ Data: https://basespace.illumina.com/sample/3756762/Ecoli 
+ Merged overlapping reads using abyss-mergepairs -q 15
+ Aligned reads to an assembly of the same reads using ABySS 1.5.2

```{r load-libraries, message=FALSE}
library(dplyr)
library(ggplot2)
library(knitr)
library(magrittr)
library(tidyr)
```

```{r read-data}
merged.data <- read.table("ecoli_merged.fastq.hist",
	col.names = c("Fragment.size", "Count"))
aligned.data <- read.table("k364/pe600-3.hist",
	col.names = c("Fragment.size", "Count"))
data <- rbind(
	merged.data %>% cbind(data.frame(Group = "Merged")),
	aligned.data %>% cbind(data.frame(Group = "Aligned")))
```

```{r summarize-data}
aligned.stats <- aligned.data %$%
	rep.int(x = Fragment.size, times = Count) %>%
	boxplot.stats(coef = 3)
str(aligned.stats)
```

```{r plot-data, message = FALSE}
ggplot(data = data) +
	aes(x = Fragment.size, y = Count, group = Group, colour = Group) +
	geom_point(size = 1) + geom_smooth() +
	xlim(aligned.stats$stats[1], aligned.stats$stats[5])
```

```{r remove-outliers}
aligned.data.omit.outliers <- aligned.data %>%
	filter(Fragment.size >= aligned.stats$stats[1]
		& Fragment.size <= aligned.stats$stats[5])
```

```{r reshape-data}
rep.aligned.data <- aligned.data.omit.outliers %$%
	data.frame(Fragment.size = rep.int(Fragment.size, Count))
```

```{r fit-normal}
normal.fit <- rep.aligned.data %$% list(
	mean = mean(Fragment.size),
	sd = sd(Fragment.size))
unlist(normal.fit)

ggplot(rep.aligned.data %>% sample_n(100000)) +
	aes(x = Fragment.size) +
	geom_histogram(binwidth = 50, aes(y = ..density..)) +
	geom_density(aes(colour = "Empirical")) +
	stat_function(fun = dnorm, aes(colour = "Normal"),
		args = normal.fit %$% list(mean = mean, sd = sd))
```

```{r tabulate-data}
kable(data)
```
